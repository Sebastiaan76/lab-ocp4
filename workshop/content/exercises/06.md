In this lab you will provision an AWS RDS (MySQL) instance and configure your application to use it.

Using the AWS YYY, provision an aws service (e.g. RDS).  Connect the aws service to the application and test it. 

Go to developer catalog. You will see many technologies which can be used.  One of them is the RDS Service you can see in the FIXME

FIXME: To do....

Now, provision an instance of MySQL RDS

```execute
svcat provision mysql --class rdsmysql --plan custom  \
   -p PubliclyAccessible=true \
   -p DBName=vote \
   -p AccessCidr=0.0.0.0/0 \
   -p MasterUsername=user \
   -p MasterUserPassword=ocpWorkshop2019 \
   -p MultiAZ=false \
   -p DBInstanceClass=db.m4.large \
   -p AutoMinorVersionUpgrade=false \
   -p PortNumber=13306 \
   -p BackupRetentionPeriod=0 \
   -p VpcId=vpc-03a00c0e08cc9bec3 
```

Check the RDS instances 


```execute
svcat get instances
```

Bind the new database with the application by creating a secret containing the access credentials (host, username, password...).

```execute
svcat bind mysql --name mysql-binding --secret-name mysql-secret
```

Check the RDS bindings 


```execute
svcat get bindings
```

The binding creates a secret containing the database's access credentials (host, username, password ...)

View the secret:

```execute
oc describe secret mysql-secret 
```

Now, connect the app to the production database by injecting the credentials into the application.

Add the credentials into the application by importing them from the secret:

```execute
oc set env --from=secret/mysql-secret dc/vote-app
```

Check the environment variables have ben properly set:

```execute
oc set env dc/vote-app --list
```

The above command should show the .... FIXME


Ensure the applicaiton is still working:

```execute 
curl -s http://vote-app-%project_namespace%.%cluster_subdomain%/ | grep "<title>"
```





Now, deprovision the productiono database

First, the binding needs to be removed.  This means removing the credentials and the secret.

```execute
svcat unbind --name mysql-binding
```

... and then the service can be deprovisioned:

```execute
svcat deprovision mysql 
```

OTHER STUFF - FIXME to delete...

Connect the application to the database:

```execute
oc set env dc vote-app \
   ENDPOINT_ADDRESS=db \
   PORT=3306 \
   DB_NAME=vote \
   MASTER_USERNAME=user \
   MASTER_PASSWORD=password \
   DB_TYPE=mysql
```

FIXME: Remove this:
```
oc set env dc vote-app \
   DB_HOST=db \
   DB_PORT=3306 \
   DB_NAME=vote \
   DB_USER=user \
   DB_PASS=password \
   DB_TYPE=mysql
```

FIXME: This is hard-coded example:
```execute
oc set env dc vote-app \
   ENDPOINT_ADDRESS=ad1b6gdqew8n954.czj7x3womnta.ap-southeast-1.rds.amazonaws.com \
   PORT=13306 \
   DB_NAME=vote \
   MASTER_USERNAME=user \
   MASTER_PASSWORD=ocpWorkshop2019 \
   DB_TYPE=mysql
```

